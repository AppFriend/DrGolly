ğŸ§‘â€ğŸ’» REPLIT DEV PROMPT: EXTEND MULTI-STEP SIGNUP FLOW + KLAYVIO & STRIPE INTEGRATION
Objective: Extend our existing /signup flow into a 3-step progressive signup journey, each step with its own URL, clear tracking in the database, and minimal friction for users.
Build upon our existing Klayvio integration â€” reusing current tracking logic, Identify API setup, and data pipelines already established. Avoid creating duplicate events or fields where already present.

âœ… KEY FEATURES SUMMARY
3-step signup flow with /signup, /createprofile, and /preferences

Database logging of step progress per user, with profile_complete = true once all 3 steps complete

Event + property tracking in Klayvio, building on current Identify + Track API usage

Stripe integration: Parse next billing date and trigger Klayvio events for purchases and billing

Maintain backward compatibility with all current API and tracking flows already implemented

ğŸ”¹ STEP 1 â€” /signup
ğŸ¯ Goal: Quickly capture email/password or Google login and create a profile entry in the DB.
Update the existing /signup page as follows:

Move first name / last name to /createprofile

Add Google Sign-In (via Firebase or existing OAuth if already integrated)

UI design to match signup design reference.png, including green cloud styling

Add:

Pre-checked checkbox: â€œBy opting in, you agree to receive marketing materials.â€

Link to /terms using: â€œBy signing up you agree to our Terms of Serviceâ€

ğŸ’¾ Database:
On successful signup:

Create user with fields: email, password (hashed), signup_method, created_at, step_completed = 1, profile_complete = false

ğŸ“¤ KLAYVIO:
Build on existing Identify and Track API logic

If not already present, add:

signup_method

profile_created_at

Ensure opt-in checkbox sets:

email_opt_in = true

sms_opt_in = true (once phone is collected in Step 2)

Fire Signed Up event only if this doesnâ€™t already exist:

json
Copy
Edit
{
  "token": "<public_api_key>",
  "event": "Signed Up",
  "customer_properties": {
    "$email": "user@example.com"
  },
  "properties": {
    "signup_method": "manual/google",
    "timestamp": "2025-08-08T12:00:00Z"
  }
}
Use existing integration methods and endpoint structures to prevent duplication.

ğŸ”¹ STEP 2 â€” /createprofile
ğŸ¯ Goal: Collect detailed user profile info.
Capture:

First Name

Last Name

Country Code + Phone Number

Profile Picture (optional)

Role Type: Parent / Grandparent / Carer

Reference layout in Profile.png

Support image upload

Phone input should be validated and saved

ğŸ’¾ Database:
Extend user model with:

first_name, last_name, phone_number, country, user_type, step_completed = 2

If Step 3 is also complete, set profile_complete = true

ğŸ“¤ KLAYVIO:
Use existing Identify call structure

Add:

first_name

last_name

user_type

phone_number (ensure parsed only if valid format)

sms_opt_in = true (if phone is provided + marketing opt-in was checked in Step 1)

ğŸ”¹ STEP 3 â€” /preferences
ğŸ¯ Goal: Capture user interest areas for future app personalisation
Multi-select options:

Baby Sleep

Toddler Sleep

Toddler Behaviour

Partner Discounts

Visual style as per Preferences.png

Responsive layout

ğŸ’¾ Database:
Save preferences as array: preferences = []

Set step_completed = 3

If step 1 + 2 are complete: profile_complete = true

ğŸ“¤ KLAYVIO:
Extend Identify call with:

preferences = ["Baby Sleep", "Toddler Behaviour"]

ğŸ” STRIPE + KLAYVIO INTEGRATION (EXTENSION ONLY)
1. âœ… NEXT BILLING DATE â€” ADDITION TO USER PROFILE
Whenever a user purchases a subscription:

Fetch from Stripe: next_billing_date via upcoming_invoice or subscription object

Store in database:

next_billing_date (nullable)

If field already exists, update on plan change or billing cycle change

ğŸ“¤ KLAYVIO:
Extend Identify API to include:

json
Copy
Edit
{
  "$email": "user@example.com",
  "next_billing_date": "2025-09-08"
}
Best practice reference: https://developers.klaviyo.com/en/docs/identify

This allows Klayvio flows for billing reminders, renewals, or payment updates.

2. âœ… PURCHASE EVENT â€” TRIGGERED ON ANY TRANSACTION
Whenever a purchase (subscription or one-time) is completed:

Fire Klayvio Purchase event using existing event tracking infrastructure

json
Copy
Edit
{
  "token": "<public_api_key>",
  "event": "Purchase",
  "customer_properties": {
    "$email": "user@example.com"
  },
  "properties": {
    "$value": 49.99,
    "$event_id": "order_xyz",
    "product_name": "Big Baby Sleep",
    "product_id": "course_6",
    "category": "Subscription",
    "timestamp": "2025-08-08T12:00:00Z"
  }
}
Best practice reference: https://developers.klaviyo.com/en/docs/track-purchases

Ensure no duplication if similar purchase logic already exists â€” simply expand the schema to align with Klayvioâ€™s standard structure.

ğŸ“‹ DATABASE FIELDS TO EXTEND (ONLY IF NOT ALREADY PRESENT)
Field	Type	Purpose
step_completed	Integer	Tracks signup stage
profile_complete	Boolean	Final stage flag
preferences	Array	Selected onboarding categories
user_type	String	Role type (Parent, Grandparent, Carer)
phone_number	String	For SMS and verification
next_billing_date	Date	From Stripe, nullable

ğŸ” REMINDER
Do NOT overwrite or duplicate existing Klayvio events or fields

Use the same endpoint, same Identify payloads, and extend only if data isnâ€™t already handled

Reference internal documentation or codebase where Identify or Purchase logic is already used (e.g. during onboarding, post-checkout)