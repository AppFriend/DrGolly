Add:

first_name

last_name

user_type

phone_number (ensure parsed only if valid format)

sms_opt_in = true (if phone is provided + marketing opt-in was checked in Step 1)

ğŸ”¹ STEP 3 â€” /preferences
ğŸ¯ Goal: Capture user interest areas for future app personalisation
Multi-select options:

Baby Sleep

Toddler Sleep

Toddler Behaviour

Partner Discounts

Visual style as per Preferences.png

Responsive layout

ğŸ’¾ Database:
Save preferences as array: preferences = []

Set step_completed = 3

If step 1 + 2 are complete: profile_complete = true

ğŸ“¤ KLAYVIO:
Extend Identify call with:

preferences = ["Baby Sleep", "Toddler Behaviour"]

ğŸ” STRIPE + KLAYVIO INTEGRATION (EXTENSION ONLY)
1. âœ… NEXT BILLING DATE â€” ADDITION TO USER PROFILE
Whenever a user purchases a subscription:

Fetch from Stripe: next_billing_date via upcoming_invoice or subscription object

Store in database:

next_billing_date (nullable)

If field already exists, update on plan change or billing cycle change

ğŸ“¤ KLAYVIO:
Extend Identify API to include:

json
Copy
Edit
{
  "$email": "user@example.com",
  "next_billing_date": "2025-09-08"
}
Best practice reference: https://developers.klaviyo.com/en/docs/identify

This allows Klayvio flows for billing reminders, renewals, or payment updates.

2. âœ… PURCHASE EVENT â€” TRIGGERED ON ANY TRANSACTION
Whenever a purchase (subscription or one-time) is completed:

Fire Klayvio Purchase event using existing event tracking infrastructure

json
Copy
Edit
{
  "token": "<public_api_key>",
  "event": "Purchase",
  "customer_properties": {
    "$email": "user@example.com"
  },
  "properties": {
    "$value": 49.99,
    "$event_id": "order_xyz",
    "product_name": "Big Baby Sleep",
    "product_id": "course_6",
    "category": "Subscription",
    "timestamp": "2025-08-08T12:00:00Z"
  }
}
Best practice reference: https://developers.klaviyo.com/en/docs/track-purchases

Ensure no duplication if similar purchase logic already exists â€” simply expand the schema to align with Klayvioâ€™s standard structure.

ğŸ“‹ DATABASE FIELDS TO EXTEND (ONLY IF NOT ALREADY PRESENT)
Field	Type	Purpose
step_completed	Integer	Tracks signup stage
profile_complete	Boolean	Final stage flag
preferences	Array	Selected onboarding categories
user_type	String	Role type (Parent, Grandparent, Carer)
phone_number	String	For SMS and verification
next_billing_date	Date	From Stripe, nullable

ğŸ” REMINDER
Do NOT overwrite or duplicate existing Klayvio events or fields

Use the same endpoint, same Identify payloads, and extend only if data isnâ€™t already handled

Reference internal documentation or codebase where Identify or Purchase logic is already used (e.g. during onboarding, post-checkout)