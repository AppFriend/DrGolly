Replit Follow-Up Prompt: Fix Post-Purchase Routing Logic and Slack Notification Trigger
Objective:
Resolve two issues in the current checkout flow for the React + TypeScript + Express app: incorrect routing after purchase based on user type, and missing Slack notification after successful payment.

Issue 1: Fix Routing for New vs Existing Users
Current Problem:
All users are being routed to /complete, regardless of whether their email is new or already registered.

Expected Behaviour:

After a successful purchase:

Check if the email entered matches an existing user in the database (case-insensitive).

If the email is not found (new user):

Route the user to /complete to finish their profile.

Allow this flow to be completed without authentication.

Once the profile is complete, automatically log the user in and route them to /home.

If the email already exists:

Log the user in directly.

Route them to /home immediately.

Ensure the purchased course is recorded in the database and appears in their Purchases dashboard.

Technical Notes:

Use a backend route such as /api/check-user-exists to confirm whether the user exists before routing.

Use the response to determine whether to display /complete or route directly to /home.

Ensure proper session handling and login logic for both new and returning users.

Issue 2: Trigger Slack Notification After Successful Purchase
Current Problem:
Slack notifications are not being triggered after a successful course purchase.

Expected Behaviour:

After Stripe confirms a successful purchase (via payment_intent.succeeded or subscription confirmation):

Trigger the existing Slack webhook with the following structure:

yaml
Copy
Edit
Single Course Purchase  
Customer First Name: [firstName]  
Customer Last Name: [lastName]  
Email: [email]  
Details: [Course Title]  
Transaction Amount: $[Final Amount]  
Promotional Code Used: [couponCode or 'NA']  
Total Discount Amount: $[discountAmount or 'NA']
Technical Notes:

Trigger the Slack notification in the Express backend, not in the frontend.

Ensure this only happens once the payment is confirmed by Stripe.

Pull coupon code and discount amount from the Stripe invoice or checkout session object.

Handle cases where no coupon is used by outputting "NA".

Testing Requirements
Test with a new user email to confirm /complete is shown and profile can be created without login.

Confirm that completing the profile logs the user in and routes them to /home.

Test with an existing user email to confirm they are logged in automatically and routed to /home.

Confirm the course appears under Purchases after login.

Test both coupon and non-coupon scenarios to validate Slack messages trigger with correct details.